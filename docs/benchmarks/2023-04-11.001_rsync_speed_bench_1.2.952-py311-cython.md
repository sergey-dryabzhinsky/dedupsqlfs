# Простые тесты скорости работы DedupSQLfs v1.2.952 за 11.04.2023

Проверка работы много-поточно-процессности на больших данных.
Плюс - частичная сборка проекта через cython.
Плюс - обнвление версии zstd.

Cинхронизация Qt с помощью rsync.

Проверка работы на движке: sqlite 3.40.1

- CPU: i5-6600K @ 3.50GHz
- DISK: 500Gb SSD NVMe

System: Ubuntu 18.04 amd64

Kernel: 5.4.0-146-lowlatency

Python: 3.11.3
- llfuse 1.4.2
- recordclass 0.18.3
- cython 0.29.34

Размер Qt в tar:

* 5.12.12 - 2825M
* 5.15.8 - 3734M
* 6.2.4 - 3611M
* 6.4.3 - 4013M
* 6.5.0 - 4013M

Другое: включен autocommit, выключен sync, hash=md5

Команда:
```sh
/usr/bin/time -v python3.11 ./mount.dedupsqlfs -vv --verbose-stats --data $HOME/Temp/sqlfs/data/ \
 --compress zstd \
 --no-sync --no-cache-flusher --minimal-compress-size -1 \
 --multi-cpu {mode} \
 -o noatime $HOME/Temp/sqlfs/mount
```

Синхронизация Qt:
```sh
rsync -aHh --stats --delete --sparse --inplace --no-whole-file {qt-dir}/ $HOME/Temp/sqlfs/mount/Qt/ && sudo umount $HOME/Temp/sqlfs/mount
```

Синхронизация происходила поверх предыдущих копий Qt. Тестировалась в том числе и дедупликация.

Тестировались только методы:

* none
* zstd(:3)

Тестировались режимы работы (--multi-cpu):

* single
* thread
* process

## Тесты

| Qt ver     | 5.12.12                                                ||||| 5.15.8                                                 ||||| 6.4.3                                                  |||||
|------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|
| **Mode**   | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** | **size** |
| none/single| 6:37.36  | 158        | 17.53      | 6.23       | 2418     | 7:15.44  | 218        | 23.25      | 5.04       | 4616     | 8:39.01  | 233        | 21.24      | 4.85       | 7432     |
|------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|
| zstd/
   single    | 7:01.75  | 150        | 5.80       | 5.87       | 944      | 7:03.02  | 230        | 8.79       | 5.13       | 1621     | 8:42.20  | 468        | 7.71       | 4.78       | 2485     |
| thread     | 6:30.51  | 215        | 5.89       | 6.29       | 949      | 6:43.02  | 301        | 10.07      | 5.40       | 1627     | 8:36.64  | 315        | 7.14       | 4.84       | 2486     |
| process    | 6:46.19  | 161        | 7.02       | 6.06       | 949      | 6:58.46  | 206        | 11.17      | 5.19       | 1631     | 7:30.38  | 253        | 9.52       | 5.54       | 2485     |

* :time   - время работы dedupsqlfs, в том числе и umount
* :memory - размер в памяти, согласно отладке в time, max resident size MiB
* :speedD - показатели отладки dedupsqlfs по скорости записи данных, MiB/s
* :speedR - показатели rsync по скорости записи данных, MiB/s
* :size   - размер итоговых данных в ~/Temp/sqlfs/data/, MiB

## Результат

Просто посмотреть и сравнить обновление версии модуля. И сколько памяти тратится.

- много-поточность сжатия - немного ускоряет работу ФС
- и много-процессность сжатия - немного замедляет работу ФС
- cython не ускоряет работу, но немного снижает потребление памяти
