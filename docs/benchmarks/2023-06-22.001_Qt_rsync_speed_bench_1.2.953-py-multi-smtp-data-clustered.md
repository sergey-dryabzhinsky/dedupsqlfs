# Простые тесты скорости работы DedupSQLfs v1.2.953 за 22.06.2023

Проверка работы много-поточно-процессности на больших данных.
Плюс - исправленная+обновленная версия модуля zstd, и обновленные - llfuse, recordclass.
Плюс - кластерные таблицы блоков, хешей.
Плюс - новые версии Qt, python.
Плюс - проверка работы "партиционирования" таблицы-файла блоков.

Cинхронизация Qt с помощью rsync.

Проверка работы на движке: sqlite 3.40.1

- CPU: i5-6600K @ 3.50GHz
- DISK: 500Gb SSD NVMe
- Файлы Qt лежат на squashfs+zstd

System: Ubuntu 18.04 amd64

Kernel: 5.4.0-150-lowlatency

Python:
- 3.7.17
- 3.8.17
- 3.9.17
- 3.10.12
- 3.11.4
- 3.12.0~b3

Модули:
- zstd: 1.5.5.0
- llfuse: 1.4.4
- recordclass: 0.18.4

Размер Qt в tar:

* 5.12.12 - 2296M (596M squashed)
* 5.15.10 - 3102M (742M squashed)
* 6.2.4 - 3034M (753 squashed)
* 6.4.3 - 3387M (866 squahsed)
* 6.5.1 - 3482M (867 squashed)

Другое: включен autocommit, выключен sync, hash=md5, blocksize=128k, 

Команда:
```sh
/usr/bin/time -v python3.11 ./mount.dedupsqlfs -vv --verbose-stats --memory-usage \
 --data $HOME/Temp/sqlfs/data/ \
 --data-clustered $HOME/Temp/sqlfs/cldata/ \
 --block-partitions 10 \
 --compress zstd:14 \
 --no-sync --no-cache-flusher --minimal-compress-size -1 \
 --multi-cpu {mode} \
 -o noatime $HOME/Temp/sqlfs/mount
```

Синхронизация Qt:
```sh
rsync -aHh --stats --delete --sparse --inplace --no-whole-file {qt-dir}/ $HOME/Temp/sqlfs/mount/Qt/ && sudo umount $HOME/Temp/sqlfs/mount
```

Синхронизация происходила поверх предыдущих копий Qt. Тестировалась в том числе и дедупликация.

Тестировались только методы (--compress):

* none
* zstd:14

Тестировались режимы работы (--multi-cpu):

* single
* thread
* process

## Тесты

| Qt ver      | 5.12.12                                                ||||| 5.15.10                                                ||||| 6.2.4                                                  ||||| 6.4.3                                                  ||||| 6.5.1                                                   |||||
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| **Mode**    | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** |  **size** |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.7   |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| none/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.8   |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| none/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.9   |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| none/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.10  |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| none/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.11  |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| none/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.12  |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| none/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| **Mode**    | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** | **size** | **time** | **memory** | **speedD** | **speedR** |  **size** |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.7   |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/thread |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/process|          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.8   |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/thread |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/process|          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.9   |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/thread |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/process|          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.10  |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/thread |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/process|          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.11  |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/thread |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/process|          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|
| python3.12  |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/single |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/thread |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
| zstd/process|          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |          |          |            |            |            |           |
|-------------|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:--------:|:--------:|:----------:|:----------:|:----------:|:---------:|

* :time   - время работы dedupsqlfs, в том числе и umount
* :memory - размер в памяти, согласно отладке в mount (--memory-usage) MiB
* :speedD - показатели отладки dedupsqlfs по скорости записи данных (write stream speed), MiB/s
* :speedR - показатели rsync по скорости записи данных, MiB/s
* :size   - размер итоговых данных в ~/Temp/sqlfs/data/, MiB + размер итоговых данных в ~/Temp/sqlfs/cldata/, MiB

## Результат

Просто посмотреть и сравнить обновление версии модуля. И сколько памяти тратится.

- rsync более агрессивно испольует ФС при синхронизации
- и много-поточность + сжатие - немного ускоряет работу ФС
- и много-процессность + сжатие - немного ускоряет работу ФС, видимо нужно использовать при более затратных методах сжатия
- плюс python3.11 работает быстрее, чем старые версии
- сжатие позитивно сказывается на времени синхронизации, меньше данных писать на диск
